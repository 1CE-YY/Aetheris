{
  "description": "Aetheris RAG 系统 API 请求/响应示例",
  "version": "1.0.0",
  "baseUrl": "http://localhost:8080/api",
  "examples": {
    "auth": {
      "register": {
        "description": "用户注册",
        "method": "POST",
        "endpoint": "/auth/register",
        "curl": "curl -X POST http://localhost:8080/api/auth/register \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"username\": \"zhang_san\",\n    \"email\": \"zhangsan@example.com\",\n    \"password\": \"password123\"\n  }'",
        "request": {
          "username": "zhang_san",
          "email": "zhangsan@example.com",
          "password": "password123"
        },
        "response": {
          "id": 1,
          "username": "zhang_san",
          "email": "zhangsan@example.com",
          "createdAt": "2025-12-25T10:00:00Z"
        },
        "errorResponse": {
          "timestamp": "2025-12-25T10:00:00Z",
          "status": 400,
          "error": "BAD_REQUEST",
          "message": "邮箱已存在",
          "path": "/api/auth/register"
        }
      },
      "login": {
        "description": "用户登录",
        "method": "POST",
        "endpoint": "/auth/login",
        "curl": "curl -X POST http://localhost:8080/api/auth/login \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"identifier\": \"zhangsan@example.com\",\n    \"password\": \"password123\"\n  }'",
        "request": {
          "identifier": "zhangsan@example.com",
          "password": "password123"
        },
        "response": {
          "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwidXNlcm5hbWUiOiJ6aGFuZ19zYW4iLCJleHAiOjE3MzUxMDQwMDB9.nN1zKqLJQDhK-KKm0oLJ3sY",
          "user": {
            "id": 1,
            "username": "zhang_san",
            "email": "zhangsan@example.com",
            "createdAt": "2025-12-25T10:00:00Z"
          }
        },
        "errorResponse": {
          "timestamp": "2025-12-25T10:05:00Z",
          "status": 401,
          "error": "UNAUTHORIZED",
          "message": "邮箱或密码错误",
          "path": "/api/auth/login"
        }
      }
    },
    "resources": {
      "upload": {
        "description": "上传学习资源",
        "method": "POST",
        "endpoint": "/resources",
        "curl": "curl -X POST http://localhost:8080/api/resources \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \\\n  -F 'file=@/path/to/deep_learning.pdf' \\\n  -F 'title=深度学习基础教程' \\\n  -F 'tags=机器学习,深度学习,神经网络' \\\n  -F 'description=本书介绍深度学习的基础概念和常用算法'",
        "request": {
          "file": "deep_learning.pdf (binary)",
          "title": "深度学习基础教程",
          "tags": "机器学习,深度学习,神经网络",
          "description": "本书介绍深度学习的基础概念和常用算法",
          "fileType": "PDF"
        },
        "response": {
          "id": 1,
          "title": "深度学习基础教程",
          "tags": "机器学习,深度学习,神经网络",
          "fileType": "PDF",
          "fileSize": 5242880,
          "description": "本书介绍深度学习的基础概念和常用算法",
          "uploadTime": "2025-12-25T10:30:00Z",
          "chunkCount": 150,
          "vectorized": true
        },
        "errorResponse": {
          "timestamp": "2025-12-25T10:30:00Z",
          "status": 400,
          "error": "BAD_REQUEST",
          "message": "资源已存在（基于内容哈希）",
          "path": "/api/resources"
        }
      },
      "list": {
        "description": "获取资源列表（分页）",
        "method": "GET",
        "endpoint": "/resources?page=0&size=20&tags=机器学习,深度学习",
        "curl": "curl -X GET 'http://localhost:8080/api/resources?page=0&size=20&tags=机器学习,深度学习' \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'",
        "response": {
          "resources": [
            {
              "id": 1,
              "title": "深度学习基础教程",
              "tags": "机器学习,深度学习,神经网络",
              "fileType": "PDF",
              "fileSize": 5242880,
              "uploadTime": "2025-12-25T10:30:00Z",
              "chunkCount": 150,
              "vectorized": true
            },
            {
              "id": 2,
              "title": "RAG 技术详解",
              "tags": "NLP,深度学习,RAG",
              "fileType": "MARKDOWN",
              "fileSize": 102400,
              "uploadTime": "2025-12-25T11:00:00Z",
              "chunkCount": 45,
              "vectorized": true
            }
          ],
          "total": 2,
          "page": 0,
          "size": 20
        }
      },
      "detail": {
        "description": "获取资源详情（含切片列表）",
        "method": "GET",
        "endpoint": "/resources/1",
        "curl": "curl -X GET http://localhost:8080/api/resources/1 \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'",
        "response": {
          "resource": {
            "id": 1,
            "title": "深度学习基础教程",
            "tags": "机器学习,深度学习,神经网络",
            "fileType": "PDF",
            "fileSize": 5242880,
            "description": "本书介绍深度学习的基础概念和常用算法",
            "uploadTime": "2025-12-25T10:30:00Z",
            "chunkCount": 150,
            "vectorized": true
          },
          "chunks": [
            {
              "id": 1,
              "chunkIndex": 0,
              "locationInfo": "PDF 第 1-3 页",
              "snippet": "第一章 引言。深度学习是机器学习的一个子领域，它基于人工神经网络..."
            },
            {
              "id": 2,
              "chunkIndex": 1,
              "locationInfo": "PDF 第 3-6 页",
              "snippet": "1.1 深度学习的历史。深度学习的概念最早可以追溯到 1940 年代的人工神经网络研究..."
            }
          ]
        }
      }
    },
    "chat": {
      "ask": {
        "description": "RAG 智能问答（带引用）",
        "method": "POST",
        "endpoint": "/chat/ask",
        "curl": "curl -X POST http://localhost:8080/api/chat/ask \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"question\": \"什么是 RAG？\",\n    \"topK\": 5\n  }'",
        "request": {
          "question": "什么是 RAG？",
          "topK": 5
        },
        "response": {
          "answer": "RAG（Retrieval-Augmented Generation，检索增强生成）是一种结合信息检索和生成式AI的技术。它先通过向量检索从知识库中召回相关文档片段，然后将这些片段作为上下文输入到大语言模型（LLM）中，生成基于事实的准确回答。",
          "citations": [
            {
              "resourceId": 2,
              "resourceTitle": "RAG 技术详解",
              "chunkId": 15,
              "chunkIndex": 3,
              "location": "Markdown 第二章第一节",
              "snippet": "RAG（Retrieval-Augmented Generation）是一种结合信息检索和生成式AI的技术...",
              "score": 0.92
            },
            {
              "resourceId": 1,
              "resourceTitle": "深度学习基础教程",
              "chunkId": 45,
              "chunkIndex": 8,
              "location": "PDF 第 25-27 页",
              "snippet": "检索增强生成（RAG）通过引入外部知识库，可以显著提升LLM的回答准确性...",
              "score": 0.85
            }
          ],
          "evidenceInsufficient": false,
          "latencyMs": 2340
        },
        "fallbackResponse": {
          "answer": "抱歉，未找到足够的相关资料来回答您的问题。以下是一些可能相关的资源：",
          "citations": [],
          "evidenceInsufficient": true,
          "fallbackResources": [
            {
              "id": 1,
              "title": "深度学习基础教程",
              "tags": "机器学习,深度学习"
            }
          ],
          "latencyMs": 1200
        }
      }
    },
    "recommendations": {
      "get": {
        "description": "获取个性化推荐",
        "method": "GET",
        "endpoint": "/recommendations?topN=10",
        "curl": "curl -X GET 'http://localhost:8080/api/recommendations?topN=10' \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'",
        "response": {
          "recommendations": [
            {
              "resource": {
                "id": 3,
                "title": "Transformer 架构详解",
                "tags": "NLP,深度学习,Transformer",
                "fileType": "PDF",
                "uploadTime": "2025-12-25T12:00:00Z",
                "chunkCount": 80
              },
              "reason": "基于您最近的查询兴趣'深度学习'和'RAG'",
              "suggestion": "建议先学习第 2 章'Self-Attention 机制'，再进入第 4 章'BERT 模型'",
              "citations": [
                {
                  "resourceId": 3,
                  "resourceTitle": "Transformer 架构详解",
                  "chunkId": 20,
                  "chunkIndex": 5,
                  "location": "PDF 第 15-18 页",
                  "snippet": "Transformer 是一种基于自注意力机制的神经网络架构，广泛应用于 NLP 领域...",
                  "score": 0.88
                }
              ]
            },
            {
              "resource": {
                "id": 4,
                "title": "自然语言处理实战",
                "tags": "NLP,实战项目",
                "fileType": "MARKDOWN",
                "uploadTime": "2025-12-25T12:30:00Z",
                "chunkCount": 60
              },
              "reason": "与您收藏的《RAG 技术详解》相关",
              "suggestion": "建议先完成第 3 章'文本分类'项目，再尝试第 6 章'问答系统'",
              "citations": [
                {
                  "resourceId": 4,
                  "resourceTitle": "自然语言处理实战",
                  "chunkId": 35,
                  "chunkIndex": 9,
                  "location": "Markdown 第六章第一节",
                  "snippet": "问答系统是 NLP 的重要应用之一，可以基于 RAG 技术构建...",
                  "score": 0.82
                }
              ]
            }
          ],
          "hasProfile": true,
          "profileUpdatedAt": "2025-12-25T14:00:00Z"
        },
        "newUserResponse": {
          "recommendations": [
            {
              "resource": {
                "id": 1,
                "title": "深度学习基础教程",
                "tags": "机器学习,深度学习",
                "fileType": "PDF"
              },
              "reason": "热门资源推荐",
              "suggestion": "适合初学者入门",
              "citations": []
            }
          ],
          "hasProfile": false,
          "profileUpdatedAt": null
        }
      }
    },
    "behaviors": {
      "recordQuery": {
        "description": "记录查询行为（自动触发）",
        "method": "POST",
        "endpoint": "/behaviors",
        "curl": "curl -X POST http://localhost:8080/api/behaviors \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"behaviorType\": \"QUERY\",\n    \"queryText\": \"什么是 Transformer？\"\n  }'",
        "request": {
          "behaviorType": "QUERY",
          "queryText": "什么是 Transformer？"
        }
      },
      "recordClick": {
        "description": "记录点击行为",
        "method": "POST",
        "endpoint": "/behaviors",
        "curl": "curl -X POST http://localhost:8080/api/behaviors \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"behaviorType\": \"CLICK\",\n    \"resourceId\": 1\n  }'",
        "request": {
          "behaviorType": "CLICK",
          "resourceId": 1
        }
      },
      "recordFavorite": {
        "description": "记录收藏行为",
        "method": "POST",
        "endpoint": "/behaviors",
        "curl": "curl -X POST http://localhost:8080/api/behaviors \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"behaviorType\": \"FAVORITE\",\n    \"resourceId\": 1\n  }'",
        "request": {
          "behaviorType": "FAVORITE",
          "resourceId": 1
        }
      },
      "recent": {
        "description": "获取最近行为历史",
        "method": "GET",
        "endpoint": "/behaviors/recent?limit=20",
        "curl": "curl -X GET 'http://localhost:8080/api/behaviors/recent?limit=20' \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'",
        "response": {
          "behaviors": [
            {
              "id": 1,
              "behaviorType": "QUERY",
              "resourceId": null,
              "queryText": "什么是 Transformer？",
              "behaviorTime": "2025-12-25T14:30:00Z"
            },
            {
              "id": 2,
              "behaviorType": "CLICK",
              "resourceId": 1,
              "queryText": null,
              "behaviorTime": "2025-12-25T14:31:00Z"
            },
            {
              "id": 3,
              "behaviorType": "FAVORITE",
              "resourceId": 2,
              "queryText": null,
              "behaviorTime": "2025-12-25T14:32:00Z"
            }
          ],
          "total": 3
        }
      }
    },
    "eval": {
      "run": {
        "description": "运行离线评测",
        "method": "POST",
        "endpoint": "/eval/run",
        "curl": "curl -X POST http://localhost:8080/api/eval/run \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"config\": {\n      \"chunkSize\": 1000,\n      \"overlap\": 200,\n      \"topK\": 5,\n      \"embeddingModel\": \"embedding-v2\",\n      \"chatModel\": \"glm-4-flash\"\n    },\n    \"compareStrategies\": true\n  }'",
        "request": {
          "config": {
            "chunkSize": 1000,
            "overlap": 200,
            "topK": 5,
            "embeddingModel": "embedding-v2",
            "chatModel": "glm-4-flash"
          },
          "compareStrategies": true
        },
        "response": {
          "runId": 1,
          "runName": "评测运行 001",
          "config": {
            "chunkSize": 1000,
            "overlap": 200,
            "topK": 5,
            "embeddingModel": "embedding-v2",
            "chatModel": "glm-4-flash"
          },
          "metrics": {
            "precisionAtK": 0.65,
            "recallAtK": 0.72,
            "avgLatencyMs": 2300,
            "p95LatencyMs": 3800
          },
          "comparison": {
            "withoutProfile": {
              "precisionAtK": 0.50,
              "recallAtK": 0.60,
              "avgLatencyMs": 2100,
              "p95LatencyMs": 3500
            },
            "withProfile": {
              "precisionAtK": 0.58,
              "recallAtK": 0.68,
              "avgLatencyMs": 2500,
              "p95LatencyMs": 4100
            },
            "precisionImprovement": 16.0
          },
          "runTime": "2025-12-25T15:00:00Z"
        }
      }
    }
  }
}
